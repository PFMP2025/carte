<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Carte Interactive de nos Voyages</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- Swiper -->
  <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
  <!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">


  <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
  <!-- Spiderfier -->
<script src="https://cdn.jsdelivr.net/npm/overlapping-marker-spiderfier-leaflet/dist/oms.min.js"></script>



  <style>
    body {
  margin: 0;
  font-family: 'Inter', sans-serif;
  background: linear-gradient(to bottom, #f9f9f9, #e0e0e0);
  color: #333;
}

#map {
  height: 100vh;
  width: 100%;
}

.leaflet-popup-content-wrapper {
  border-radius: 12px !important;
  box-shadow: 0 8px 20px rgba(0,0,0,0.15) !important;
}

.popup-content {
  font-size: 15px;
  padding: 10px;
  line-height: 1.5;
}

.popup-content h3 {
  margin-top: 0;
  font-size: 20px;
  font-weight: 600;
  color: #222;
}

.swiper-container {
  width: 100%;
  height: auto;
  margin-top: 10px;
}

.swiper-slide {
  text-align: center;
}

.swiper-slide img {
  width: 100%;
  height: auto;
  border-radius: 8px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  cursor: pointer;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.swiper-slide img:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 12px rgba(0,0,0,0.15);
}

.popup-content a.project-link {
  display: inline-block;
  margin-top: 12px;
  color: #0066ff;
  font-weight: 600;
  text-decoration: none;
  transition: color 0.2s;
}

.popup-content a.project-link:hover {
  color: #0044cc;
  text-decoration: underline;
}

/* Galerie plein √©cran */
.fullscreen-gallery {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100vw;
  height: 100vh;
  background: #000;
  background: rgba(0, 0, 0, 0.96);
  z-index: 9999;
}

.fullscreen-gallery.active {
  display: block;
}

.fullscreen-gallery .swiper-slide img {
  max-height: 80vh;
  max-width: 100%;
  object-fit: contain;
}

.close-gallery {
  position: absolute;
  top: 15px;
  right: 25px;
  font-size: 36px;
  color: #fff;
  cursor: pointer;
  z-index: 10000;
  transition: transform 0.2s;
}

.close-gallery:hover {
  transform: scale(1.2);
}

/* Popup Genially responsive */
.leaflet-popup-content-wrapper.popup-genially {
  width: auto !important;
  max-width: 95vw !important;
  padding: 0 !important;
  border-radius: 12px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.2);
}

.leaflet-popup-content.popup-genially {
  margin: 0 !important;
  padding: 0 !important;
  width: 100% !important;
}

.popup-genially iframe {
  width: 100% !important;
  height: 100% !important;
  display: block;
  border: none;
}
.leaflet-popup-content-wrapper {
  background-color: #0a0f24 !important;
  color: #00e5ff !important;
  border: 1px solid #00e5ff;
  border-radius: 10px;
  box-shadow: 0 0 12px #00e5ff77;
}
.pulse-marker {
  animation: pulse 1.5s infinite;
}

@keyframes pulse {
  0% { transform: scale(1); opacity: 0.7; }
  50% { transform: scale(1.3); opacity: 1; }
  100% { transform: scale(1); opacity: 0.7; }
}
#background-animation {
  position: fixed;
  top: 0; left: 0;
  width: 100vw;
  height: 100vh;
  background: radial-gradient(#00bfff22 1px, transparent 1px);
  background-size: 40px 40px;
  z-index: 0;
  pointer-events: none;
}

#map {
  position: relative;
  z-index: 1;
}
.leaflet-marker-icon {
  filter: drop-shadow(0 0 8px #00e5ff);
  transition: transform 0.2s ease;
}

.leaflet-marker-icon:hover {
  transform: scale(1.15);
}
.leaflet-popup {
  animation: fadeInUp 0.3s ease-out;
}

@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(20px); }
  to   { opacity: 1; transform: translateY(0); }
}
.popup-content {
  font-size: 14px;
  color: #cfe8ff;
  padding: 12px;
  max-width: 300px;
  line-height: 1.4;
}

.popup-content h3 {
  margin: 0 0 8px 0;
  font-size: 16px;
  color: #00d4ff;
  font-weight: 700;
}

.popup-desc {
  margin-bottom: 10px;
}

.popup-swiper {
  border-radius: 6px;
  overflow: hidden;
}

.popup-swiper .swiper-slide img {
  height: auto;
  width: 100%;
  border-radius: 6px;
  box-shadow: 0 0 5px #00bfff66;
}

.project-link {
  display: inline-block;
  margin-top: 10px;
  color: #00bfff;
  font-weight: 600;
  text-decoration: none;
}

.project-link:hover {
  text-decoration: underline;
}
#fullscreenGenially iframe {
  width: 100vw;
  height: 100vh;
  display: block;
}


  </style>
</head>
<body>
<div id="background-animation"></div>

  <div id="map"></div>

  <!-- üì∏ Galerie photo plein √©cran -->
<div id="fullscreenGallery" class="fullscreen-gallery">
  <div class="close-gallery" onclick="closeGallery()">&times;</div>
  <div class="swiper-container fullscreen-swiper">
    <div class="swiper-wrapper" id="fullscreenSlides"></div>
    <div class="swiper-button-next"></div>
    <div class="swiper-button-prev"></div>
  </div>
</div>

<!-- üåê Genially plein √©cran -->
<div id="fullscreenGenially" class="fullscreen-gallery">
  <div class="close-gallery" onclick="closeGenially()">&times;</div>
  <iframe id="geniallyFrame" src="" frameborder="0" allowfullscreen loading="lazy"></iframe>
</div>


<script>
  const map = L.map('map', {
    center: [50, 10],
    zoom: 4,
    scrollWheelZoom: true,
    zoomControl: true
  });

  const oms = new OverlappingMarkerSpiderfier(map, {
    keepSpiderfied: true,
    nearbyDistance: 80,
    circleSpiralSwitchover: 6,
    legWeight: 1.5,
    legColors: {
      usual: '#00e5ff',
      highlighted: '#ff4081'
    }
  });

  const vueInitiale = {
    center: [50, 10],
    zoom: 4
  };

  // Recentre la carte quand on ferme un popup
  map.on('popupclose', () => {
    map.setView(vueInitiale.center, vueInitiale.zoom);
  });

  L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; OpenStreetMap & CartoDB',
    maxZoom: 19
  }).addTo(map);

  function openGallery(images) {
    const container = document.getElementById('fullscreenSlides');
    container.innerHTML = images.map(src => `
      <div class="swiper-slide"><img src="${src}" alt="galerie"></div>
    `).join('');
    document.getElementById('fullscreenGallery').classList.add('active');
    new Swiper('.fullscreen-swiper', {
      initialSlide: 0,
      loop: true,
      navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' }
    });
  }

  function closeGallery() {
    document.getElementById('fullscreenGallery').classList.remove('active');
    map.setView(vueInitiale.center, vueInitiale.zoom);
  }

  function ajouterPoint(lat, lon, titre, description, images, lienProjet, iconePerso = null) {
    const slides = images.map(src => `
      <div class="swiper-slide">
        <img src="${src}" alt="miniature" onclick='openGallery(${JSON.stringify(images)})'>
      </div>
    `).join('');

    const swiperHTML = `
      <div class="swiper-container popup-swiper">
        <div class="swiper-wrapper">${slides}</div>
        <div class="swiper-button-prev"></div>
        <div class="swiper-button-next"></div>
      </div>
    `;

    const htmlPopup = `
      <div class="popup-content">
        <h3>${titre}</h3>
        <p class="popup-desc">${description}</p>
        ${swiperHTML}
        <a class="project-link" href="${lienProjet}" target="_blank">Voir le projet complet</a>
      </div>
    `;

    const markerOptions = iconePerso
      ? { icon: L.icon({ iconUrl: iconePerso, iconSize: [48, 48], iconAnchor: [24, 48], popupAnchor: [0, -48] }) }
      : {};

    const marker = L.marker([lat, lon], markerOptions)
      .bindPopup(htmlPopup, { maxWidth: 400 });

    marker.on('popupopen', () => {
      new Swiper('.swiper-container', {
        slidesPerView: 2,
        spaceBetween: 10,
        navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' }
      });
    });

    marker.addTo(map);        // ‚úÖ Important pour qu'il apparaisse !
    oms.addMarker(marker);    // ‚úÖ Pour spiderfier les proches
  }

  // üéØ Marqueur 1 ‚Äì Stuttgart
  ajouterPoint(
    48.7758, 9.1829, 'Stuttgart, Allemagne', 'Projet OPHAGE+ en mars 2024.', [
      "1749022414742.jpg", "1749022414746.jpg", "1749022414748.jpg", "1749022414752.jpg", "1749022414754.jpg",
      "1749022414757.jpg", "1749022414760.jpg", "1749022414763.jpg", "1749022414766.jpg", "1749022414769.jpg",
      "1749022414772.jpg", "1749022414775.jpg", "1749022414781.jpg", "1749022414787.jpg", "1749022414790.jpg",
      "1749022414794.jpg", "1749022414798.jpg", "1749022414800.jpg", "1749022414806.jpg", "1749022414809.jpg",
      "1749022414812.jpg", "1749022414815.jpg", "1749022414818.jpg", "1749022414821.jpg", "1749022414825.jpg",
      "1749022414828.jpg", "1749022414832.jpg", "1749022414836.jpg", "1749022414839.jpg", "1749022414842.jpg",
      "1749553668331.jpg", "1749553668333.jpg", "1749553668336.jpg"
    ],
    'projets/stuttgart.html',
    'Franco-allemand.png'
  );

  // üéØ Marqueur 2 ‚Äì Lyc√©e Darras
  const lyceeMarker = L.marker([50.43110, 2.79050], {
    icon: L.icon({
      iconUrl: "Lyc√©e.png",
      iconSize: [48, 48],
      iconAnchor: [24, 48],
      popupAnchor: [0, -48]
    })
  }).bindPopup(`
    <div class="popup-genially">
      <h3 style="padding:10px; text-align:center;">Lyc√©e Henri Darras - Li√©vin</h3>
      <div style="position:relative; width:95vw; height:53.43vw;">
        <iframe src="https://view.genial.ly/63f732e6f4bfe000186a90c5/presentation-presentation-lycee-professionnel-henri-darras-lievin"
                allowfullscreen loading="lazy"></iframe>
        <button onclick="openGeniallyFullscreen('https://view.genial.ly/63f732e6f4bfe000186a90c5/presentation-presentation-lycee-professionnel-henri-darras-lievin')" 
                style="position:absolute; top:10px; right:10px; padding:6px 12px; font-weight:bold; font-size:14px; background:#00bfff; color:white; border:none; border-radius:6px; cursor:pointer; z-index:10;">
          üîç Plein √©cran
        </button>
      </div>
    </div>
  `, {
    maxWidth: 9999,
    className: 'popup-genially'
  });

  lyceeMarker.addTo(map);          // ‚úÖ Ajouter √† la carte
  oms.addMarker(lyceeMarker);      // ‚úÖ Ajouter √† spiderfier

  // üéØ Marqueur 3 ‚Äì La Coupole
  ajouterPoint(
    50.7205, 2.2304,
    'La Coupole d‚ÄôHelfaut',
    'Sortie scolaire devoir de m√©moire.',
    ["coupole1.jpg", "coupole2.jpg", "coupole3.jpg", "coupole4.jpg"],
    'projets/coupole.html',
    'coupole.png'
  );

  // Plein √©cran Genially
  function openGeniallyFullscreen(url) {
    document.getElementById('geniallyFrame').src = url;
    document.getElementById('fullscreenGenially').classList.add('active');
    map.closePopup();
  }

  function closeGenially() {
    document.getElementById('fullscreenGenially').classList.remove('active');
    document.getElementById('geniallyFrame').src = '';
    map.setView(vueInitiale.center, vueInitiale.zoom);
  }
</script>

</body>
</html>
